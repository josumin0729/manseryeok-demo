<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>만세력 달력 - 데모</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #ffffff;
      color: #000000;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    h1 {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 14px;
      color: #666666;
    }

    /* 달력 스타일 */
    .calendar {
      margin-bottom: 40px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-header h2 {
      font-size: 20px;
      font-weight: 600;
    }

    .nav-button {
      padding: 8px 16px;
      background: #f5f5f5;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }

    .nav-button:hover {
      background: #e0e0e0;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #e0e0e0;
      border: 1px solid #e0e0e0;
    }

    .calendar-day-header {
      background: #f5f5f5;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      color: #666666;
    }

    .calendar-day {
      background: #ffffff;
      padding: 12px 8px;
      min-height: 80px;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
    }

    .calendar-day:hover {
      background: #f9f9f9;
    }

    .calendar-day.selected {
      background: #f0f0f0;
    }

    .calendar-day.other-month {
      color: #cccccc;
      background: #fafafa;
    }

    .day-number {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 4px;
    }

    .day-ganzhi {
      font-size: 12px;
      color: #666666;
    }

    /* 탭 네비게이션 */
    .tabs {
      display: flex;
      gap: 0;
      margin-bottom: 30px;
      border-bottom: 1px solid #e0e0e0;
    }

    .tab {
      flex: 1;
      padding: 14px 20px;
      background: #ffffff;
      border: none;
      cursor: pointer;
      font-size: 15px;
      color: #666666;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab:hover {
      color: #000000;
    }

    .tab.active {
      color: #000000;
      font-weight: 600;
      border-bottom: 2px solid #000000;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* 일진 정보 */
    .day-info {
      margin-bottom: 40px;
    }

    .info-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #fafafa;
      border-left: 3px solid #000000;
    }

    .info-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-content {
      font-size: 15px;
      color: #333333;
      line-height: 1.7;
    }

    .info-label {
      display: inline-block;
      font-weight: 600;
      color: #666666;
      min-width: 80px;
    }

    /* 12신살/12운성 테이블 */
    .fortune-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .fortune-table th {
      background: #f5f5f5;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      border-bottom: 2px solid #e0e0e0;
    }

    .fortune-table td {
      padding: 12px;
      border-bottom: 1px solid #f0f0f0;
    }

    /* 자미두수 궁위 */
    .palace-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .palace-card {
      padding: 20px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
    }

    .palace-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .palace-subtitle {
      font-size: 13px;
      color: #666666;
      margin-bottom: 12px;
    }

    .palace-stars {
      font-size: 14px;
      color: #333333;
      margin-bottom: 12px;
      font-weight: 500;
    }

    .palace-summary {
      font-size: 14px;
      color: #333333;
      line-height: 1.6;
    }

    /* 반응형 */
    @media (max-width: 768px) {
      .calendar-grid {
        font-size: 12px;
      }

      .calendar-day {
        min-height: 60px;
        padding: 8px 4px;
      }

      .palace-grid {
        grid-template-columns: 1fr;
      }

      .tabs {
        flex-wrap: wrap;
      }

      .tab {
        font-size: 13px;
        padding: 10px 12px;
      }
    }

    /* 로딩 */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666666;
    }

    /* 에러 */
    .error {
      padding: 20px;
      background: #fee;
      color: #c00;
      border-left: 3px solid #c00;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>만세력 달력</h1>
      <p class="subtitle">한국 전통 만세력 기반 일진 조회 시스템 (데모)</p>
    </header>

    <!-- 달력 -->
    <div class="calendar">
      <div class="calendar-header">
        <button class="nav-button" onclick="changeMonth(-1)">◀ 이전</button>
        <h2 id="currentMonth">2026년 3월</h2>
        <button class="nav-button" onclick="changeMonth(1)">다음 ▶</button>
      </div>

      <div class="calendar-grid">
        <div class="calendar-day-header">일</div>
        <div class="calendar-day-header">월</div>
        <div class="calendar-day-header">화</div>
        <div class="calendar-day-header">수</div>
        <div class="calendar-day-header">목</div>
        <div class="calendar-day-header">금</div>
        <div class="calendar-day-header">토</div>
        <div id="calendarDays"></div>
      </div>
    </div>

    <!-- 선택된 날짜 정보 -->
    <div id="selectedDateInfo" style="display: none;">
      <h3 style="margin-bottom: 20px; font-size: 20px;">선택한 날: <span id="selectedDate"></span></h3>

      <!-- 탭 -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('overview')">일진</button>
        <button class="tab" onclick="switchTab('twelve')">12신살/12운성</button>
        <button class="tab" onclick="switchTab('palace')">자미두수</button>
        <button class="tab" onclick="switchTab('daeun')">대운</button>
      </div>

      <!-- 탭 컨텐츠 -->
      <div id="tab-overview" class="tab-content active">
        <div id="overviewContent"></div>
      </div>

      <div id="tab-twelve" class="tab-content">
        <div id="twelveContent"></div>
      </div>

      <div id="tab-palace" class="tab-content">
        <div id="palaceContent"></div>
      </div>

      <div id="tab-daeun" class="tab-content">
        <div id="daeunContent"></div>
      </div>
    </div>
  </div>

  <script>
    // 전역 변수
    let koreaData = {};
    let jamiData = {};
    let dictionaryData = {};
    let daeunData = {};
    let currentYear = 2026;
    let currentMonth = 3; // 3월
    let selectedDate = null;

    // 데이터 로드
    async function loadData() {
      try {
        const [koreaRes, jamiRes, dictRes, daeunRes] = await Promise.all([
          fetch('/data/korea_data_sample.json'),
          fetch('/data/jami_data_sample.json'),
          fetch('/data/dictionary_FINAL.json'),
          fetch('/data/life_phase_fortune_sample.json')
        ]);

        koreaData = await koreaRes.json();
        jamiData = await jamiRes.json();
        dictionaryData = await dictRes.json();
        daeunData = await daeunRes.json();

        renderCalendar();
      } catch (error) {
        console.error('데이터 로드 실패:', error);
        document.querySelector('.container').innerHTML = '<div class="error">데이터를 불러오는데 실패했습니다.</div>';
      }
    }

    // 달력 렌더링
    function renderCalendar() {
      const firstDay = new Date(currentYear, currentMonth - 1, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
      
      let html = '';
      
      // 이전 달 날짜
      for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day other-month"></div>';
      }
      
      // 현재 달 날짜
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = koreaData[dateStr];
        const ganzhi = dayData ? dayData.day_ganzhi : '';
        
        html += `
          <div class="calendar-day" onclick="selectDate('${dateStr}')">
            <div class="day-number">${day}</div>
            <div class="day-ganzhi">${ganzhi}</div>
          </div>
        `;
      }
      
      document.getElementById('calendarDays').innerHTML = html;
      document.getElementById('currentMonth').textContent = `${currentYear}년 ${currentMonth}월`;
    }

    // 월 변경
    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth > 12) {
        currentMonth = 1;
        currentYear++;
      } else if (currentMonth < 1) {
        currentMonth = 12;
        currentYear--;
      }
      renderCalendar();
    }

    // 날짜 선택
    function selectDate(dateStr) {
      selectedDate = dateStr;
      const data = koreaData[dateStr];
      
      if (!data) {
        alert('해당 날짜의 데이터가 없습니다.');
        return;
      }

      // 선택 표시
      document.querySelectorAll('.calendar-day').forEach(day => {
        day.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');

      // 정보 표시
      document.getElementById('selectedDateInfo').style.display = 'block';
      document.getElementById('selectedDate').textContent = dateStr;
      
      renderOverview(data);
      renderTwelve(data);
      renderPalace();
      renderDaeun();

      // 스크롤
      document.getElementById('selectedDateInfo').scrollIntoView({ behavior: 'smooth' });
    }

    // 일진 탭 렌더링
    function renderOverview(data) {
      const html = `
        <div class="info-section">
          <div class="info-title">기본 정보</div>
          <div class="info-content">
            <div><span class="info-label">일진:</span> ${data.day_ganzhi}</div>
            <div><span class="info-label">십성:</span> ${data.ten_god} - ${data.ten_god_plain}</div>
            <div><span class="info-label">28수:</span> ${data.constellation_28} - ${data.constellation_28_plain}</div>
            <div><span class="info-label">지지관계:</span> ${data.relation_earthly} - ${data.relation_earthly_plain}</div>
          </div>
        </div>

        <div class="info-section">
          <div class="info-title">오늘의 운세</div>
          <div class="info-content">
            <div><strong>테마:</strong> ${data.theme}</div>
            <div style="margin-top: 10px;"><strong>조언:</strong> ${data.advice}</div>
            <div style="margin-top: 10px;"><strong>메시지:</strong> ${data.message}</div>
          </div>
        </div>
      `;
      document.getElementById('overviewContent').innerHTML = html;
    }

    // 12신살/12운성 탭 렌더링
    function renderTwelve(data) {
      const html = `
        <div class="info-section">
          <div class="info-title">12운성</div>
          <table class="fortune-table">
            <tr>
              <th>운성</th>
              <th>의미</th>
            </tr>
            <tr>
              <td><strong>${data.twelve_woonsung}</strong></td>
              <td>${data.twelve_woonsung_plain}</td>
            </tr>
          </table>
        </div>

        <div class="info-section">
          <div class="info-title">12신살</div>
          <table class="fortune-table">
            <tr>
              <th>신살</th>
              <th>의미</th>
            </tr>
            <tr>
              <td><strong>${data.twelve_shinsal}</strong></td>
              <td>${data.twelve_shinsal_plain}</td>
            </tr>
          </table>
        </div>
      `;
      document.getElementById('twelveContent').innerHTML = html;
    }

    // 자미두수 탭 렌더링
    function renderPalace() {
      let html = '<div class="palace-grid">';
      
      for (const [palaceName, data] of Object.entries(jamiData)) {
        html += `
          <div class="palace-card">
            <div class="palace-name">${palaceName}</div>
            <div class="palace-subtitle">${data.subtitle}</div>
            <div class="palace-stars">주요성: ${data.stars}</div>
            <div class="palace-summary">${data.summary}</div>
          </div>
        `;
      }
      
      html += '</div>';
      document.getElementById('palaceContent').innerHTML = html;
    }

    // 대운 탭 렌더링
    function renderDaeun() {
      let html = '<div class="info-section">';
      html += '<div class="info-title">대운 (大運)</div>';
      html += '<div class="info-content">';
      
      if (daeunData.daeun_list) {
        daeunData.daeun_list.forEach(daeun => {
          html += `
            <div style="margin-bottom: 20px; padding: 15px; background: #ffffff; border-left: 3px solid #666666;">
              <div style="font-weight: 600; margin-bottom: 8px;">
                ${daeun.age_range} - ${daeun.pillar} (${daeun.main_energy})
              </div>
              <div style="color: #333333;">${daeun.description}</div>
            </div>
          `;
        });
      }
      
      html += '</div></div>';
      
      // 초년/중년/말년
      html += '<div class="info-section" style="margin-top: 30px;">';
      html += '<div class="info-title">생애 주기</div>';
      html += '<div class="palace-grid">';
      
      if (daeunData.life_cycles) {
        daeunData.life_cycles.forEach(cycle => {
          html += `
            <div class="palace-card">
              <div class="palace-name">${cycle.period}</div>
              <div class="palace-subtitle">${cycle.age_range}</div>
              <div style="margin: 10px 0; font-weight: 500;">키워드: ${cycle.keywords.join(', ')}</div>
              <div class="palace-summary">${cycle.summary}</div>
            </div>
          `;
        });
      }
      
      html += '</div></div>';
      
      document.getElementById('daeunContent').innerHTML = html;
    }

    // 탭 전환
    function switchTab(tabName) {
      // 탭 버튼
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.currentTarget.classList.add('active');

      // 탭 컨텐츠
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    // 초기화
    loadData();
  </script>
</body>
</html>
